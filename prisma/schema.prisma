generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  USER
  POD_OWNER
  ADMIN
}

enum PostType {
  OWNER_UPDATE
  MEMBER_UPDATE
}

enum PodSubcategory {
  INCUBATION
  COMMUNITY
  VENTURE_CAPITALIST
  ANGEL_INVESTOR
  ANGEL_NETWORK
  SERVICE_PROVIDER
  ACCELERATOR
  CORPORATE_INNOVATION
  GOVERNMENT_PROGRAM
  UNIVERSITY_ENTREPRENEURSHIP_CELL
}

enum OrganisationType {
  GOVERNMENT
  PRIVATE
}

enum StartupStage {
  IDEA
  MVP
  EARLY_TRACTION
  GROWTH
  SCALE
}

enum PitchStatus {
  NEW
  VIEWED
  REPLIED
  SHORTLISTED
  ACCEPTED
  REJECTED
}

enum MessageRequestStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum CallBookingStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum JobType {
  JOB
  INTERNSHIP
}

enum RoomType {
  GENERAL
  QA
}

enum RoomPrivacy {
  PUBLIC
  PRIVATE
}

model User {
  id        String   @id @default(uuid()) @unique
  email     String   @unique
  username  String   @unique
  password  String
  mobile    String?
  role      UserRole @default(USER)
  fullName  String?
  bio       String?
  avatar    String?
  
  // Additional profile fields
  profilePhoto               String?
  professionCategory         String?
  organisationName           String?
  brandName                  String?
  designation                String?
  workingExperienceFrom      DateTime?
  workingExperienceTo        DateTime?
  startupSubcategory         String?
  businessType               String?
  briefAboutOrganisation     String?
  operatingCity              String?
  website                    String?
  // Student specific fields
  collegeName                String?
  currentCourse              String?
  yearSemester               String?
  interestDomain             String?
  // Startup specific fields
  startupFoundedYear         String?
  // Working professional specific fields
  workingDomain              String?
  linkedinUrl                String?
  instagramUrl               String?
  facebookUrl                String?
  twitterUrl                 String?
  youtubeUrl                 String?
  githubUrl                  String?
  portfolioUrl               String?
  othersUrl                  String?
  additionalLinks            String[]         @default([])
  lastLoginAt                DateTime?
  acceptingCalls             Boolean          @default(true)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  ownedPods              Pod[]                 @relation("PodOwner")
  coOwnedPods            Pod[]                 @relation("PodCoOwners")
  podMemberships         PodMember[]
  posts                  Post[]
  reactions              Reaction[]
  comments               Comment[]
  messages               Message[]
  eventParticipants      EventParticipant[]
  pitches                Pitch[]
  pitchReplies           PitchReply[]
  chatsParticipated      ChatParticipant[]
  sentMessageRequests    MessageRequest[]      @relation("SentMessageRequests")
  receivedMessageRequests MessageRequest[]     @relation("ReceivedMessageRequests")
  callBookingsRequested  CallBooking[]         @relation("CallBookingRequester")
  callBookingsReceived   CallBooking[]         @relation("CallBookingTarget")
  notifications          Notification[]
  questions              Question[]
  answers                Answer[]
  roomJoinRequests       RoomJoinRequest[]     @relation("UserRoomJoinRequests")
  roomReadStatus         RoomReadStatus[]
  startupIdeas           StartupIdea[]
  jobApplications        JobApplication[]
  pushSubscriptions      PushSubscription[]

  @@map("users")
}

model Pod {
  id                        String           @id @default(uuid())
  name                      String
  description               String?
  logo                      String?
  avatar                    String?
  coverImage                String?
  subcategory               PodSubcategory?
  focusAreas                String[]
  organisationName          String?
  organisationType          OrganisationType?
  organisationEmail         String?
  operatingCity             String?
  totalInvestmentSize       String?
  numberOfInvestments       Int?
  briefAboutOrganisation    String?
  linkedinUrl               String?
  instagramUrl              String?
  facebookUrl               String?
  twitterUrl                String?
  youtubeUrl                String?
  othersUrl                 String?
  additionalLinks           String[]         @default([])
  website                   String?
  
  // Incubation
  supportedDomains          String[]         @default([])
  supportedStages           String[]         @default([])
  
  // Community
  communityType             String?
  
  // Venture Capital, Angel Investor, Angel Network
  investmentAreas           String[]         @default([])
  investmentStages          String[]         @default([])
  chequeSize                String?
  investmentThesis          String?
  
  // Service Provider
  serviceType               String?
  
  // Accelerator
  programmeDuration         String?
  numberOfStartups          Int?
  focusedSectors            String[]         @default([])
  benefits                  String?
  
  // Corporate Innovation
  innovationFocusArea       String?
  collaborationModel        String?
  fundingGrantSupport       String?
  
  // Government Programme
  schemeName                String?
  programmeObjectives       String?
  benefitsOffered           String?
  eligibilityCriteria       String?
  
  // University E Cell
  eventsConducted           String[]         @default([])
  
  isPublic                  Boolean          @default(true)
  isApproved                Boolean          @default(false)
  isVerified                Boolean          @default(false)
  acceptingPitches          Boolean          @default(true)
  ownerId                   String
  createdAt                 DateTime         @default(now())
  updatedAt                 DateTime         @updatedAt

  // Relations
  owner         User           @relation("PodOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  coOwners      User[]         @relation("PodCoOwners")
  members       PodMember[]
  posts         Post[]
  rooms         Room[]
  events        Event[]
  pitches       Pitch[]
  callBookings  CallBooking[]

  @@index([ownerId])
  @@index([name])
  @@index([subcategory])
  @@index([isApproved])
  @@map("pods")
}

model PodMember {
  id        String   @id @default(uuid())
  podId     String
  userId    String
  isCoOwner Boolean  @default(false)
  joinedAt  DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  pod  Pod  @relation(fields: [podId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([podId, userId])
  @@index([podId])
  @@index([userId])
  @@map("pod_members")
}

model Post {
  id         String   @id @default(uuid())
  content    String
  mediaUrls  String[]
  mediaType  String?
  type       PostType
  podId      String
  authorId   String
  isOwnerPost Boolean @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  pod       Pod        @relation(fields: [podId], references: [id], onDelete: Cascade)
  author    User       @relation(fields: [authorId], references: [id], onDelete: Cascade)
  reactions Reaction[]
  comments  Comment[]

  @@index([podId])
  @@index([authorId])
  @@index([type])
  @@index([createdAt])
  @@map("posts")
}

model Reaction {
  id        String   @id @default(uuid())
  type      String   // e.g., "like", "love", "wow", "sad", "angry"
  postId    String
  userId    String
  createdAt DateTime @default(now())

  // Relations
  post Post @relation(fields: [postId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([postId, userId, type])
  @@index([postId])
  @@index([userId])
  @@map("reactions")
}

model Comment {
  id        String   @id @default(uuid())
  postId    String
  authorId  String
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  post   Post @relation(fields: [postId], references: [id], onDelete: Cascade)
  author User @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([authorId])
  @@index([createdAt])
  @@map("comments")
}

model Room {
  id          String      @id @default(uuid())
  name        String
  description String?
  podId       String
  type        RoomType    @default(GENERAL)
  privacy     RoomPrivacy @default(PUBLIC)
  createdBy   String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  // Relations
  pod          Pod                @relation(fields: [podId], references: [id], onDelete: Cascade)
  messages     Message[]
  questions    Question[]
  members      RoomMember[]
  joinRequests RoomJoinRequest[]  @relation("RoomJoinRequests")
  readStatus   RoomReadStatus[]

  @@index([podId])
  @@index([type])
  @@map("rooms")
}

model RoomMember {
  id         String    @id @default(uuid())
  roomId     String
  userId     String
  joinedAt   DateTime  @default(now())
  lastReadAt DateTime? @updatedAt

  // Relations
  room Room @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@unique([roomId, userId])
  @@index([roomId])
  @@index([userId])
  @@map("room_members")
}

model RoomJoinRequest {
  id        String              @id @default(uuid())
  roomId    String
  userId    String
  status    RoomRequestStatus   @default(PENDING)
  createdAt DateTime            @default(now())
  updatedAt DateTime            @updatedAt

  // Relations
  room Room @relation("RoomJoinRequests", fields: [roomId], references: [id], onDelete: Cascade)
  user User @relation("UserRoomJoinRequests", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([roomId, userId])
  @@index([roomId])
  @@index([userId])
  @@index([status])
  @@map("room_join_requests")
}

enum RoomRequestStatus {
  PENDING
  ACCEPTED
  REJECTED
}

model RoomReadStatus {
  id         String   @id @default(uuid())
  roomId     String
  userId     String
  lastReadAt DateTime @updatedAt

  // Relations
  room Room @relation(fields: [roomId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([roomId, userId])
  @@index([roomId])
  @@index([userId])
  @@map("room_read_status")
}

model Message {
  id         String   @id @default(uuid())
  content    String
  roomId     String?
  chatId     String?
  senderId   String
  replyToId  String?
  mediaUrl   String?
  mediaType  String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  room      Room?     @relation(fields: [roomId], references: [id], onDelete: Cascade)
  chat      Chat?     @relation(fields: [chatId], references: [id], onDelete: Cascade)
  sender    User      @relation(fields: [senderId], references: [id], onDelete: Cascade)
  replyTo   Message?  @relation("MessageReplies", fields: [replyToId], references: [id], onDelete: SetNull)
  replies   Message[] @relation("MessageReplies")

  @@index([roomId])
  @@index([chatId])
  @@index([senderId])
  @@index([replyToId])
  @@index([createdAt])
  @@map("messages")
}

model Question {
  id        String   @id @default(uuid())
  roomId    String
  authorId  String
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  room    Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)
  author  User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  answers Answer[]

  @@index([roomId])
  @@index([authorId])
  @@index([createdAt])
  @@map("questions")
}

model Answer {
  id         String   @id @default(uuid())
  questionId String
  authorId   String
  content    String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  question Question @relation(fields: [questionId], references: [id], onDelete: Cascade)
  author   User     @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@index([questionId])
  @@index([authorId])
  @@map("answers")
}

model Event {
  id          String   @id @default(uuid())
  name        String
  title       String?
  description String?
  type        String   // "online" | "offline"
  date        DateTime
  time        String
  location    String?
  helpline    String?
  imageUrl    String?
  podId       String
  createdBy   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  pod          Pod                @relation(fields: [podId], references: [id], onDelete: Cascade)
  participants EventParticipant[]

  @@index([podId])
  @@index([date])
  @@index([type])
  @@map("events")
}

model EventParticipant {
  id        String   @id @default(uuid())
  eventId   String
  userId    String
  joinedAt  DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([eventId, userId])
  @@index([eventId])
  @@index([userId])
  @@map("event_participants")
}

model Pitch {
  id              String       @id @default(uuid())
  podId           String
  founderId       String
  startupName     String
  pitchDeckUrl    String?
  summary         String
  sector          String
  stage           StartupStage
  ask             String
  operatingCity   String
  website         String?
  contactEmail    String
  contactPhone    String
  status          PitchStatus  @default(NEW)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  // Relations
  pod     Pod          @relation(fields: [podId], references: [id], onDelete: Cascade)
  founder User         @relation(fields: [founderId], references: [id], onDelete: Cascade)
  replies PitchReply[]

  @@index([podId])
  @@index([founderId])
  @@index([status])
  @@index([createdAt])
  @@map("pitches")
}

model PitchReply {
  id        String   @id @default(uuid())
  pitchId   String
  authorId  String
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  pitch  Pitch @relation(fields: [pitchId], references: [id], onDelete: Cascade)
  author User  @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@index([pitchId])
  @@index([authorId])
  @@map("pitch_replies")
}

model Chat {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  participants ChatParticipant[]
  messages     Message[]

  @@map("chats")
}

model ChatParticipant {
  id        String   @id @default(uuid())
  chatId    String
  userId    String
  joinedAt  DateTime @default(now())

  // Relations
  chat Chat @relation(fields: [chatId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([chatId, userId])
  @@index([chatId])
  @@index([userId])
  @@map("chat_participants")
}

model MessageRequest {
  id             String               @id @default(uuid())
  senderId       String
  receiverId     String
  initialMessage String
  status         MessageRequestStatus @default(PENDING)
  createdAt      DateTime             @default(now())
  respondedAt    DateTime?
  updatedAt      DateTime             @updatedAt

  // Relations
  sender   User @relation("SentMessageRequests", fields: [senderId], references: [id], onDelete: Cascade)
  receiver User @relation("ReceivedMessageRequests", fields: [receiverId], references: [id], onDelete: Cascade)

  @@unique([senderId, receiverId])
  @@index([senderId])
  @@index([receiverId])
  @@index([status])
  @@map("message_requests")
}

model CallBooking {
  id             String            @id @default(uuid())
  podId          String
  requesterId    String
  targetUserId   String
  targetRole     String            // "owner" | "co-owner"
  purpose        String
  preferredDate  DateTime?
  preferredTime  String?
  status         CallBookingStatus @default(PENDING)
  remark         String?
  createdAt      DateTime          @default(now())
  respondedAt    DateTime?
  updatedAt      DateTime          @updatedAt

  // Relations
  pod       Pod  @relation(fields: [podId], references: [id], onDelete: Cascade)
  requester User @relation("CallBookingRequester", fields: [requesterId], references: [id], onDelete: Cascade)
  target    User @relation("CallBookingTarget", fields: [targetUserId], references: [id], onDelete: Cascade)

  @@index([podId])
  @@index([requesterId])
  @@index([targetUserId])
  @@index([status])
  @@map("call_bookings")
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  type      String   // "pod_join" | "post_like" | "comment" | "message" | "pitch" | "event"
  title     String
  message   String
  linkedId  String?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
  @@map("notifications")
}

model StartupIdea {
  id          String   @id @default(uuid())
  userId      String
  title       String
  description String
  category    String?
  tags        String[] @default([])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
  @@map("startup_ideas")
}

model JobApplication {
  id            String   @id @default(uuid())
  userId        String
  candidateName String
  type          JobType
  domain        String
  brief         String
  resumeUrl     String
  contactEmail  String?
  contactPhone  String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@index([domain])
  @@index([createdAt])
  @@map("job_applications")
}

model IdolPitchDeck {
  id          String   @id @default(uuid())
  title       String
  description String?
  companyName String
  pdfUrl      String
  thumbnailUrl String?
  uploadedBy  String?  // Admin user ID who uploaded
  isActive    Boolean  @default(true)
  viewCount   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([isActive])
  @@index([createdAt])
  @@map("idol_pitch_decks")
}

model PushSubscription {
  id         String   @id @default(uuid())
  userId     String
  endpoint   String   @unique
  p256dh     String
  auth       String
  userAgent  String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("push_subscriptions")
}
